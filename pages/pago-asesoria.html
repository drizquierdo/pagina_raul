<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Completa tu compra de la Asesor√≠a Online de Nutrici√≥n. Pago seguro con Stripe y PayPal.">
    <meta name="robots" content="noindex, nofollow">
    
    <title>Pago - Asesor√≠a Online | Academia Metabolix</title>
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="../css/main.css">
    
    <!-- Stripe JS -->
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <!-- Navegaci√≥n simplificada -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-container">
                <a href="../" class="navbar-brand">Academia Metabolix</a>
                <div class="text-sm text-secondary">Checkout seguro</div>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <main class="main-content">
        <section class="section">
            <div class="container">
                <div class="checkout-container">
                    <!-- Encabezado -->
                    <div class="text-center mb-2xl">
                        <h1>Finalizar compra</h1>
                        <p class="text-secondary">Reserva tu asesor√≠a personalizada de nutrici√≥n</p>
                    </div>

                    <!-- Resumen del pedido -->
                    <div class="order-summary">
                        <h3 class="mb-lg">Resumen del pedido</h3>
                        <div class="d-flex justify-between align-center mb-md">
                            <div>
                                <h4>Asesor√≠a Online de Nutrici√≥n</h4>
                                <p class="text-sm text-secondary">Sesi√≥n √∫nica de 90 minutos + plan personalizado</p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-gradient">$1000 MXN</div>
                            </div>
                        </div>
                        <div class="divider"></div>
                        <div class="d-flex justify-between align-center">
                            <strong>Total a pagar:</strong>
                            <strong class="text-2xl text-gradient">$1000 MXN</strong>
                        </div>
                        
                        <div class="bg-light p-4 rounded-lg mt-lg">
                            <h5 class="mb-md">üìÖ Pr√≥ximo paso despu√©s del pago:</h5>
                            <p class="text-sm">Recibir√°s un email con el enlace para elegir tu horario preferido en nuestro calendario online.</p>
                        </div>
                    </div>

                    <!-- Formulario de datos -->
                    <form id="checkout-form" class="mb-xl">
                        <h3 class="mb-lg">Informaci√≥n personal</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nombre *</label>
                                <input type="text" class="input" name="firstName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Apellidos *</label>
                                <input type="text" class="input" name="lastName" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" class="input" name="email" required>
                            <small class="text-xs text-secondary">Recibir√°s el enlace de agendamiento en este email</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tel√©fono *</label>
                            <input type="tel" class="input" name="phone" required>
                            <small class="text-xs text-secondary">Para contactarte antes de la sesi√≥n</small>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Pa√≠s *</label>
                                <select class="input" name="country" required>
                                    <option value="">Selecciona tu pa√≠s</option>
                                    <option value="MX">M√©xico</option>
                                    <option value="US">Estados Unidos</option>
                                    <option value="ES">Espa√±a</option>
                                    <option value="AR">Argentina</option>
                                    <option value="CO">Colombia</option>
                                    <option value="PE">Per√∫</option>
                                    <option value="CL">Chile</option>
                                    <option value="other">Otro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Zona horaria *</label>
                                <select class="input" name="timezone" required>
                                    <option value="">Selecciona tu zona horaria</option>
                                    <option value="America/Mexico_City">M√©xico (GMT-6)</option>
                                    <option value="America/New_York">Este de EE.UU. (GMT-5)</option>
                                    <option value="America/Los_Angeles">Oeste de EE.UU. (GMT-8)</option>
                                    <option value="Europe/Madrid">Espa√±a (GMT+1)</option>
                                    <option value="America/Argentina/Buenos_Aires">Argentina (GMT-3)</option>
                                    <option value="America/Bogota">Colombia (GMT-5)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Motivo principal de la consulta (opcional)</label>
                            <textarea class="input" name="reason" rows="3" placeholder="Ej: Resistencia a la insulina, control de peso, PCOS, etc."></textarea>
                            <small class="text-xs text-secondary">Esto nos ayuda a preparar mejor tu sesi√≥n</small>
                        </div>
                    </form>

                    <!-- M√©todos de pago -->
                    <div class="mb-xl">
                        <h3 class="mb-lg">M√©todo de pago</h3>
                        
                        <div class="payment-methods">
                            <div class="payment-method active" data-method="stripe">
                                <h4>üí≥ Tarjeta de cr√©dito/d√©bito</h4>
                                <p class="text-sm text-secondary">Visa, Mastercard, American Express</p>
                                <small class="text-xs text-secondary">Procesado por Stripe (seguro)</small>
                            </div>
                            <div class="payment-method" data-method="paypal">
                                <h4>üÖøÔ∏è PayPal</h4>
                                <p class="text-sm text-secondary">Paga con tu cuenta PayPal</p>
                                <small class="text-xs text-secondary">Redirige a PayPal</small>
                            </div>
                        </div>
                    </div>

                    <!-- Formulario de tarjeta (Stripe) -->
                    <div id="stripe-form" class="mb-xl">
                        <h4 class="mb-lg">Informaci√≥n de la tarjeta</h4>
                        <div id="card-element" class="input" style="padding: 12px;">
                            <!-- Stripe Elements se insertar√° aqu√≠ -->
                        </div>
                        <div id="card-errors" class="error-message" style="display: none;"></div>
                    </div>

                    <!-- PayPal (oculto inicialmente) -->
                    <div id="paypal-form" class="mb-xl" style="display: none;">
                        <div id="paypal-button-container"></div>
                    </div>

                    <!-- T√©rminos y condiciones -->
                    <div class="form-group mb-xl">
                        <label class="d-flex align-start gap-md">
                            <input type="checkbox" id="terms" required>
                            <span class="text-sm">
                                Acepto los <a href="./privacidad.html" target="_blank" class="text-gradient">t√©rminos y condiciones</a> 
                                y la <a href="./privacidad.html" target="_blank" class="text-gradient">pol√≠tica de privacidad</a>. 
                                Entiendo que podr√© agendar mi cita despu√©s del pago y que puedo reprogramar hasta 24h antes.
                            </span>
                        </label>
                    </div>

                    <!-- Bot√≥n de pago -->
                    <button type="button" id="pay-button" class="btn btn-primary w-full" disabled>
                        <span id="pay-button-text">Pagar $1000 MXN</span>
                        <span id="pay-button-loading" style="display: none;">
                            <div class="spinner"></div>
                            Procesando...
                        </span>
                    </button>

                    <!-- Garant√≠as -->
                    <div class="text-center mt-xl">
                        <div class="d-flex justify-center gap-lg text-sm text-secondary mb-md">
                            <span>üîí Pago 100% seguro</span>
                            <span>üìÖ Elige tu horario</span>
                            <span>üîÑ Reprogramaci√≥n gratuita</span>
                        </div>
                        <p class="text-xs text-secondary">
                            ¬øProblemas con el pago? Cont√°ctanos: 
                            <a href="mailto:nutricion@rulmanzana.com" class="text-gradient">nutricion@rulmanzana.com</a>
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Scripts -->
    <script src="../js/main.js"></script>
    <script src="../js/payments.js"></script>
    
    <script>
        // Inicializar procesamiento de pagos para asesor√≠as
        document.addEventListener('DOMContentLoaded', function() {
            initializeConsultationPayments();
        });
        
        function initializeConsultationPayments() {
            // Configurar Stripe
            const stripe = Stripe('pk_test_51234567890abcdef'); // Reemplazar con clave real
            const elements = stripe.elements();
            
            // Crear elemento de tarjeta
            const cardElement = elements.create('card', {
                style: {
                    base: {
                        fontSize: '16px',
                        color: '#0F172A',
                        '::placeholder': {
                            color: '#64748B',
                        },
                    },
                },
            });
            
            cardElement.mount('#card-element');
            
            // Manejar errores de tarjeta
            cardElement.on('change', function(event) {
                const displayError = document.getElementById('card-errors');
                if (event.error) {
                    displayError.textContent = event.error.message;
                    displayError.style.display = 'block';
                } else {
                    displayError.style.display = 'none';
                }
                
                updatePayButton();
            });
            
            // Cambio de m√©todo de pago
            const paymentMethods = document.querySelectorAll('.payment-method');
            paymentMethods.forEach(method => {
                method.addEventListener('click', function() {
                    paymentMethods.forEach(m => m.classList.remove('active'));
                    this.classList.add('active');
                    
                    const selectedMethod = this.dataset.method;
                    if (selectedMethod === 'stripe') {
                        document.getElementById('stripe-form').style.display = 'block';
                        document.getElementById('paypal-form').style.display = 'none';
                    } else {
                        document.getElementById('stripe-form').style.display = 'none';
                        document.getElementById('paypal-form').style.display = 'block';
                        initializePayPal();
                    }
                    
                    updatePayButton();
                });
            });
            
            // Checkbox de t√©rminos
            document.getElementById('terms').addEventListener('change', updatePayButton);
            
            // Bot√≥n de pago
            document.getElementById('pay-button').addEventListener('click', function() {
                const activeMethod = document.querySelector('.payment-method.active').dataset.method;
                
                if (activeMethod === 'stripe') {
                    processStripePayment(stripe, cardElement);
                }
            });
            
            function updatePayButton() {
                const form = document.getElementById('checkout-form');
                const terms = document.getElementById('terms');
                const payButton = document.getElementById('pay-button');
                const activeMethod = document.querySelector('.payment-method.active').dataset.method;
                
                const formValid = form.checkValidity();
                const termsAccepted = terms.checked;
                
                if (activeMethod === 'stripe') {
                    payButton.disabled = !(formValid && termsAccepted);
                    payButton.style.display = 'block';
                } else {
                    payButton.style.display = 'none';
                }
            }
            
            function processStripePayment(stripe, cardElement) {
                const payButton = document.getElementById('pay-button');
                const payButtonText = document.getElementById('pay-button-text');
                const payButtonLoading = document.getElementById('pay-button-loading');
                
                // Mostrar loading
                payButtonText.style.display = 'none';
                payButtonLoading.style.display = 'flex';
                payButton.disabled = true;
                
                // Obtener datos del formulario
                const form = document.getElementById('checkout-form');
                const formData = new FormData(form);
                
                // Simular procesamiento (en producci√≥n conectar con backend)
                setTimeout(() => {
                    // Simular √©xito
                    window.location.href = './gracias-asesoria.html?payment=success';
                }, 2000);
            }
            
            function initializePayPal() {
                // Configurar PayPal para asesor√≠as
                if (window.paypal) {
                    paypal.Buttons({
                        createOrder: function(data, actions) {
                            return actions.order.create({
                                purchase_units: [{
                                    amount: {
                                        value: '850.00',
                                        currency_code: 'MXN'
                                    },
                                    description: 'Asesor√≠a Online de Nutrici√≥n - Academia Metabolix'
                                }]
                            });
                        },
                        onApprove: function(data, actions) {
                            return actions.order.capture().then(function(details) {
                                window.location.href = './gracias-asesoria.html?payment=success&method=paypal';
                            });
                        },
                        onError: function(err) {
                            console.error('Error en PayPal:', err);
                            alert('Error en el procesamiento del pago. Por favor intenta de nuevo.');
                        }
                    }).render('#paypal-button-container');
                }
            }
        }
    </script>
    
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=MXN"></script>
</body>
</html>

